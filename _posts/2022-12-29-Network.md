---
title: 计算机网络体系
date: 2022-12-29 15:00:00 +0800
categories: [技术科普]
tags: [学习]
pin: true
author: YKFire

toc: true
comments: true

math: false
mermaid: true

typora-root-url: ../../YKFire.github.io

---

# 计算机网络体系 

## 一、简介

简单来说，计算机网络就是用于满足不同机器之间通信、共享的一种系统。

其实一开始计算机网络是用于军事化目的的，因美国军方需要一种多节点的通信技术，确保在其一部分节点被摧毁后，也能够确保通信依旧正常，因此组建了一个部门`ARPA`并在1966年完成了`ARPANET`（阿帕网）项目，该项目也是最早的计算机网络之一。
 当然，后续随着科技不断进步，各种网络相关的技术百家争鸣，出现了各式各样的网络技术，但同时也带来了很大的局限性，例如：不同的计算机网络之间并不能相互通信、不同操作系统之间无法通信、覆盖范围及其有限等。因此，`ARPA`需要一种技术将不同的计算机局域网互联，最终`ARPA`组织创建了一个新的项目被称为`internetwork`因特网，也被称为“互联网”。

  在`internetwork`项目的研发过程中，1974年，`Robert E. Kahn`以及`Vinton G. Cerf`两位教授正式提出了新的传输协议：`TCP/IP`协议，用于满足不同计算机网络之间的互联通信，`ARPA`到`1982`年接受`TCP/IP`选定为`Internet`主要的计算机通信系统，作为因特网通信的“基石”。

## 二、 组成与核心功能

### 1、组成

计算机网络主要由主机、协议、传输介质以及软件四部分组成

- 主机：可以是手机、电脑、服务器、电子手表等任意计算机硬件
- 协议：各类定义归法的网络通信协议，如`TCP/IP、IPX/SPX、AppleTalk`等
- 传输介质：传输数据的通道，可以是实体铜线、电缆、光纤，也可以是无形的电磁波空间介质
- 软件：涵盖所有联网的应用，如QQ、微信、支付宝、淘宝、京东等各类软件

### 2、核心功能

计算机网络体系主要提供的两个核心功能就在于：

- 资源共享：资源子网实现
- 数据通信：通信子网实现

资源子网以及通信子网也对应着`OSI`中的上三层和下三层

## 三、网络分层与三种模型

> - 法定标准体系：`OSI`七层结构
> - 实际应用体系：`TCP/IP`四层结构
> - 原理教学体系：五层结构

### 1、OSI模型

​	计算机网络是个非常复杂的系统，由于最初各个计算机网络体系结构不同，导致双方网络之间无法互通，因此，20世纪90年代，`ISO`国际标准化推出了`OSI`模型打算制定计算机网络体系标准。

![OPI传输数据](/assets/blog_res/2022-12-29-Network.assets/image-20221231201034931.png)

### 2、TCP/IP体系结构

​	但由`ISO`组织制定的`OSI`网络七层模型结构并没有得到广泛应用，实际中应用最广泛的是`TCP/IP`体系结构。换句话说，`OSI`七层模型只是理论上官方制定的国际标准，而`TCP/IP`体系结构才是事实上的国际标准。

![TCP/IP体系结构传输数据](/assets/blog_res/2022-12-29-Network.assets/image-20221231201121492.png)

### 3、五层模型体系结构

​	但因为`TCP/IP`体系中的最后一层没有制定规范的标准，所以对于学习计算机网络完善体系时会缺失一部分，所以又提出了一种折中方案，也就是综合`OSI`以及`TCP/IP`两个体系的优缺点，提出了一种五层结构的原理体系。

因此在接触计算机网络体系时，通常都会存在三种分层结构：

![三种模型](/assets/blog_res/2022-12-29-Network.assets/image-20221231200901382.png)

## 四、IP协议

> 属于网络成协议

  当应用层的数据被封装后，想要将数据在网络上传输，数据究竟要被发往何处，又该如何精准的在网络上定位目标机器，此时起到关键作用的就是“`IP`协议”。
 `IP`协议的作用在于把各种数据包准确无误的传递给目标方，其中两个重要的条件是`IP`地址和`MAC`地址。其中`IP`地址就是所有主机在网络通信中的唯一标识，但由于`IP`地址是稀有资源，不可能每个主机都拥有一个`IP`地址，因此路由器里面会记录我们主机的`MAC`地址，通常的`IP`地址是路由器根据`MAC`地址生成的，而`MAC`地址是全球唯一的。

> IP地址就如同是物流线路上的驿站地址，而MAC地址就是具体货架上货物的位置

### 1、组成与分类

 `IP`地址一般由**网络标识(`NetID`)\**和\**主机标识(`HostID`)** 两部分组成，其中网络标识对应着网络地址，表示其局域网属于互联网中的哪一个网络；主机标识对应着一台机器的主机地址，表示机器属于该局域网络中的哪一台主机。
 通常情况下，一个`IP`存在四组数字，每组数字对应着八位二进制数字（一个`IP`地址共计`32Bit`），每组之间分别用`.`隔开，其中不同类型的`IP`地址，表示网络标识和主机标识的数字段也不同，目前的`IP`地址主要可分为`A、B、C、D、E`五大类，如下：

![IP地址分类](/assets/blog_res/2022-12-29-Network.assets/image-20221231202558755.png)

因不同类型的网络`IP`规模不同，所以它们也分别应用于不同的场景，如：

- ①`A`类`IP`适用于大型网络，由于单个网络中可容纳的主机数非常巨大，因此常被保留给政府机构使用。
- ②`B`类`IP`适用于中型网络，一般会被分配给公益组织、中大型企业等。
- ③`C`类`IP`适用于小型网络，这种`IP`适用于所有需要网络的个体和小集体，如网吧、家庭、个人电脑等。
- ④`D`类`IP`用于组播。
- ⑤`E`类`IP`用于保留和实验。

### 2、子网掩码

子网掩码又被称为网络掩码、地址掩码、子网络遮罩，它的作用主要有两个：

- 一、区分`IP`中网络地址和主机地址。
- 二、划分子网，扩大网段内的可用`IP`数目。

但默认的子网掩码值也并非都相同，不同的网络类型存在不同的默认掩码，如：

- `A`类网络的默认子网掩码：`255.0.0.0`
- `B`类网络的默认子网掩码：`255.255.0.0`
- `C`类网络的默认子网掩码：`255.255.255.0`

一个子网掩码决定着一个子网（独立的单个网络）内可容纳的主机数量，计算公式为：可容纳的主机数量=(`2`的`n`次方)`-2`。这个`n`可以理解为二进制掩码中`0`的数量，例如：

- A类默认掩码：`255.0.0.0`转换为二进制为：`11111111.00000000.00000000.00000000`，后面有`24`个`0`，因此可容纳的主机数量为(`2`的`24`次方)`-2`，即`16777214`台主机。
- C类默认掩码：`255.255.255.0`转换为二进制为：`11111111.11111111.11111111.00000000`，后面存在`8`个`0`，因此`C`类网可容纳主机数量为(`2`的`8`次方)`-2`，即`254`台主机。

### 3、IPv4与IPv6

 目前的网络几乎大部分还是基于`IPv4`版本，但同时大部分应用程序也开始支持`IPv6`，`IPv6`是“`Internet Protocol Version 6`（互联网协议第6版）”的缩写，是用于替代`IPv4`的下一代`IP`协议，也就是下一代互联网的协议。

  `IPv6`相较于`IPv4`而言，主要不同点在于：

- 地址空间不同，`IPv4`地址采用`32`位长度，`IPv6`的地址则采用`128`位长度。
- `IPv6`的路由表会比`IPv4`更小、更精细。
- `IPv6`的组播支持以及对流的支持要强于`IPv4`。
- `IPv6`的安全性更高，使用`IPv6`的用户可对网络层数据进行加密。
- 协议扩充不同，`IPv6`允许协议进行扩充，而`IPv4`不允许。

前述的`IP`协议分析都是基于`IPv4`版本而言的，因为目前主流的网络版本还是`IPv4`，但如今也逐步向`IPv6`过渡。



## 五、TCP协议与UDP协议

> 两者都属于传输层协议

### 1、TCP协议

`TCP(Transmission Control Protocol)`传输控制协议是面向连接的可靠传输协议，是位于传输层的核心协议之一，在不可靠的互联网络上，`IP`协议只提供了简单不可靠的包交换，但网络中不同主机之间经常需要一种可靠的、类似于管道一样的连接、流机制，去稳定传输一些数据，如视频、音频、图片等大文件数据。
 因此`TCP`应运而生，`TCP`协议是为了在不可靠的互联网络上提供可靠的端到端之间，字节流传输而专门设计的一个传输协议，`TCP`中采用字节流传输数据。

#### 1、TCP报文头结构

![TCP报文头结构](/assets/blog_res/2022-12-29-Network.assets/image-20221231202755774.png)

 当应用层向传输层传递数据时，`TCP`会首先对数据流进行分段，将大的数据拆分成一个个的数据报文段，然后会将封装好的数据包传递给网络层的`IP`层。同时，为了防止数据在网络传输中丢包，`TCP`也会对每个数据包分配一个序号，当接收方成功收到发送的数据后，会返回一个`ACK`确认，如果发送方在规定的合理时间（`RTT`）内未收到接收方的`ACK`，那么对应的数据包会被认定为已丢失，发送方会将该段数据重新传输。

#### 2、连接管理机制 - 三次握手与四次挥手

​	由于`TCP`是基于管道连接式通信的协议，因此在数据传递之前，必须要先建立连接，当数据传输完毕后，也必须要关闭连接。因此，这就引出了面试过程中人尽皆知的问题：“**为什么`TCP`是三次握手，四次挥手！**”

三次握手：

 所谓的`TCP`三次握手，其实是指`TCP`建立连接的过程，因为`TCP`属于可靠性的传输协议，因此在发送数据前必须要先确保发送/接收数据的双方状态正常，因此需要经过“三次握手”的过程，具体如下：

![`TCP`是三次握手](/assets/blog_res/2022-12-29-Network.assets/image-20221231202945763.png)

四次挥手：

当“三次握手”完成后，客户端和服务端之间会成功建立连接，从此开启双方端到端之间的数据传输，当一方数据传输完成后，会尝试中断连接，因此又会经历“四次挥手”的过程，如下：

![四次挥手](/assets/blog_res/2022-12-29-Network.assets/image-20221231203023402.png)

> 为什么TCP是三次握手，四次挥手?
>
> 因为建立连接“握手”时，当服务端接收到“客户端想与服务端建立连接”的请求后，可以立马返回“同意+与客户端建立连接”报文，客户端也确认建立连接后，就可以称为“握手完成”。
>  但关闭连接时的“挥手”，因为一方数据传输完成后就会提出关闭连接，不过另外一方可能还依旧存在数据未发送完成，因此服务端就不能在“确认关闭”连接的时候，也同时发出“关闭连接”的请求，因为自己的数据还没发送完成呢，所以会等到自身的数据全部传输后，再主动向客户端发起一次“关闭连接”的请求，等待客户端“确认关闭”后，从而完成整个“挥手”动作。

### 2、UDP协议

`UDP(User Datagram Protocol)`协议是传输层的一个不可靠传输协议，它为应用程序提供了一种无需建立连接就可以发送封装的`IP`数据包的方法。在传输层中，与`TCP`协议互补，`UDP`除了给应用层提供了发送数据包的功能外，几乎没有做任何其他事情。而面向连接的`TCP`恰恰相反，几乎做了所有的事情。

  刚刚提到过，`UDP`仅为应用层提供了发送数据报的功能，主要就是指`UDP`对`IP`协议的扩充：

- ①建立在`IP`协议的基础上，扩展出端口号，可使数据分发到具体的应用程序。
- ②建立在`IP`协议的基础上，扩展出数据传输过程中的数据差错效验机制。

#### 1、UDP报文头

![UDP报文头](/assets/blog_res/2022-12-29-Network.assets/image-20221231203344109.png)

对比`TCP`复杂的报文头结构，`UDP`的头部就显得比较简单了，整个头共`8`字节：

- ①源端口/目的端口：指数据发送方的应用进程端口号及接收方的进程端口号。
- ②报文长度：`Header+Data`的总长度，因为`UDP`头为`8`字节，所以该值最小为`8`。
- 效验和：检测UDP数据报在传输中是否有错，有则丢弃（`UDP`检验和并非必须的），就算效验时检测出错误，也仅只是丢弃数据包，不会对数据进行纠正，也就是不会重发数据报。

#### 2、核心流程

`UDP`是一个无连接的协议，因此采用`UDP`传输协议的程序，在传递数据时，不会存在建立/释放连接的过程。当数据需要传输时，会对于应用层的数据简单的封装，也就是加上自己的`UDP`头后，直接会将数据丢给`IP`层，然后交由链路传输。

> 正因为如上特性，因此`UDP`的传输速度仅受到数据生成的速度、计算机算力和传输带宽的限制。

在接收端，`UDP`会把每个消息段放在队列/缓冲区中，程序每次从队列中读一个消息段。当然，接收端收到数据后，也会对数据做效验，但效验完成后，如若数据存在差错，那`UDP`只会单纯的丢弃该数据包，不会要求发送端重发数据。

> 因为由于`UDP`高效的传输性能，因此常备应用在广播通知、音频通话、视频传输等多媒体数据流业务，而且这类业务中，如果有一个数据包丢失，在很短的时间内就会有另一个新的数据就会替换它，因此就算数据传输不可靠也无关紧要。